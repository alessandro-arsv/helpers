local TweenService = game:GetService("TweenService")
local CoreGui = game:GetService("CoreGui")
local Debris = game:GetService("Debris")

local Icons = {
    Error = "rbxassetid://5107154082",
    Success = "rbxassetid://8266856324",
    Warning = "rbxassetid://85147473315465"
}

local Colors = {
    Error = Color3.fromRGB(255, 85, 85),
    Success = Color3.fromRGB(85, 255, 150),
    Warning = Color3.fromRGB(255, 180, 80),
    Default = Color3.fromRGB(0, 170, 255)
}

local ScreenGui = Instance.new("ScreenGui")
ScreenGui.Name = "alessandro-notifications"
ScreenGui.Parent = CoreGui
ScreenGui.DisplayOrder = 999

local Holder = Instance.new("Frame")
Holder.Name = "Holder"
Holder.Size = UDim2.new(0, 310, 1, -20)
Holder.Position = UDim2.new(1, -10, 1, -10)
Holder.AnchorPoint = Vector2.new(1, 1)
Holder.BackgroundTransparency = 1
Holder.Parent = ScreenGui

local UIListLayout = Instance.new("UIListLayout")
UIListLayout.Padding = UDim.new(0, 10)
UIListLayout.HorizontalAlignment = Enum.HorizontalAlignment.Right
UIListLayout.VerticalAlignment = Enum.VerticalAlignment.Bottom -- Forces stacking from bottom
UIListLayout.SortOrder = Enum.SortOrder.LayoutOrder
UIListLayout.Parent = Holder

local function CreateNotification(title, msg, type, duration)
    duration = duration or 5
    local accentColor = Colors[type] or Colors.Default
    
    local Container = Instance.new("Frame")
    Container.Name = "NotificationContainer"
    Container.Size = UDim2.new(1, 0, 0, 0)
    Container.BackgroundTransparency = 1
    Container.ClipsDescendants = false
    Container.LayoutOrder = -os.clock() * 1000
    Container.Parent = Holder

    local Main = Instance.new("CanvasGroup") 
    Main.Name = "Main"
    Main.Size = UDim2.new(1, 0, 0, 75)
    Main.Position = UDim2.new(1.5, 0, 0, 0)
    Main.BackgroundColor3 = Color3.fromRGB(15, 15, 15)
    Main.GroupTransparency = 1
    Main.BorderSizePixel = 0
    Main.Parent = Container

    local UICorner = Instance.new("UICorner")
    UICorner.CornerRadius = UDim.new(0, 8)
    UICorner.Parent = Main

    local UIStroke = Instance.new("UIStroke")
    UIStroke.Thickness = 1.8
    UIStroke.Color = accentColor
    UIStroke.Transparency = 0.5
    UIStroke.Parent = Main

    local Icon = Instance.new("ImageLabel")
    Icon.Size = UDim2.new(0, 26, 0, 26)
    Icon.Position = UDim2.new(0, 12, 0.5, -13)
    Icon.BackgroundTransparency = 1
    Icon.Image = Icons[type] or Icons.Success
    Icon.ImageColor3 = accentColor
    Icon.Parent = Main

    local TitleLabel = Instance.new("TextLabel")
    TitleLabel.Size = UDim2.new(1, -60, 0, 20)
    TitleLabel.Position = UDim2.new(0, 50, 0, 12)
    TitleLabel.BackgroundTransparency = 1
    TitleLabel.Text = title:upper()
    TitleLabel.TextColor3 = Color3.fromRGB(255, 255, 255)
    TitleLabel.Font = Enum.Font.GothamBold
    TitleLabel.TextSize = 14
    TitleLabel.TextXAlignment = Enum.TextXAlignment.Left
    TitleLabel.Parent = Main

    local DescLabel = Instance.new("TextLabel")
    DescLabel.Size = UDim2.new(1, -60, 0, 30)
    DescLabel.Position = UDim2.new(0, 50, 0, 32)
    DescLabel.BackgroundTransparency = 1
    DescLabel.Text = msg
    DescLabel.TextColor3 = Color3.fromRGB(200, 200, 200)
    DescLabel.Font = Enum.Font.Gotham
    DescLabel.TextSize = 12
    DescLabel.TextXAlignment = Enum.TextXAlignment.Left
    DescLabel.TextYAlignment = Enum.TextYAlignment.Top
    DescLabel.TextWrapped = true
    DescLabel.RichText = true
    DescLabel.Parent = Main

    local TimeBar = Instance.new("Frame")
    TimeBar.Size = UDim2.new(1, 0, 0, 2)
    TimeBar.Position = UDim2.new(0, 0, 1, -2)
    TimeBar.BackgroundColor3 = accentColor
    TimeBar.BorderSizePixel = 0
    TimeBar.Parent = Main

    local function Intro()
        TweenService:Create(Container, TweenInfo.new(0.4, Enum.EasingStyle.Quint), {Size = UDim2.new(1, 0, 0, 80)}):Play()
        TweenService:Create(Main, TweenInfo.new(0.5, Enum.EasingStyle.Back), {
            Position = UDim2.new(0, 0, 0, 0),
            GroupTransparency = 0
        }):Play()
        
        local s = Instance.new("Sound")
        s.SoundId = "rbxassetid://4590657391"
        s.Volume = 0.5
        s.Parent = CoreGui
        s:Play()
        Debris:AddItem(s, 2)
    end

    Intro()

    TweenService:Create(TimeBar, TweenInfo.new(duration, Enum.EasingStyle.Linear), {Size = UDim2.new(0, 0, 0, 2)}):Play()

    task.delay(duration, function()
        local exit = TweenService:Create(Main, TweenInfo.new(0.4, Enum.EasingStyle.Quint, Enum.EasingDirection.In), {
            Position = UDim2.new(1.5, 0, 0, 0),
            GroupTransparency = 1
        })
        exit:Play()
        exit.Completed:Connect(function()
            -- Collapse the container (slides old notifications back down)
            local collapse = TweenService:Create(Container, TweenInfo.new(0.3), {Size = UDim2.new(1, 0, 0, 0)})
            collapse:Play()
            collapse.Completed:Connect(function()
                Container:Destroy()
            end)
        end)
    end)
end

return CreateNotification
